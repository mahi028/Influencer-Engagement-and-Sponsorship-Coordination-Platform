{% extends 'base.html' %}
{%block title%}{{page}}{%endblock%}
{% block content %}
<style>
    body {
        background-color: #f8f9fa;
    }
    .post-card {
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .post-img {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        border: 5px solid white;
        object-fit: cover;
    }
    .post-info {
        margin-top: 20px;
    }
    .post-info h2 {
        margin-bottom: 10px;
    }
</style>


<div class="container">
    <div class="profile-content text-center">
        {%if post.flag%}
            <h3 style="color: red;">Flagged</h3>
            <p>{{post.flag_reason}}</p>
        {%endif%}
        <div class="post-card bg-white p-4">
            <img src="/st/uploads/{{post.image_path}}" alt="post Image" class="post-img" id="post-img"> 
            <div class="post-info">
                <h2 id="post_title"> 
                    {{post.post_title}}
                    {%if current_user.user_id == post.post_by%}
                        <button type="button" class="btn" onclick="profile_edit_form(`/user/edit/{{post.post_id}}`, 'post_title', 'post_title')">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pen" viewBox="0 0 16 16"><path d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001m-.644.766a.5.5 0 0 0-.707 0L1.95 11.756l-.764 3.057 3.057-.764L14.44 3.854a.5.5 0 0 0 0-.708z"></path></svg>
                        </button>
                    {%endif%}
                </h2>
                <p>
                    <strong>Description:</strong> 
                    <span id="desc">{{post.desc}} 
                        {%if current_user.user_id == post.post_by%}
                        <button type="button" class="btn" onclick="profile_edit_form(`/user/edit/{{post.post_id}}`, `desc`, 'desc')">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pen" viewBox="0 0 16 16"><path d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001m-.644.766a.5.5 0 0 0-.707 0L1.95 11.756l-.764 3.057 3.057-.764L14.44 3.854a.5.5 0 0 0 0-.708z"></path></svg>
                        </button>
                        {%endif%}
                    </span>
                </p>
                <p class="text-muted">
                    <strong>Post By:</strong>
                    <span id="post_by">
                        <a href="/get/{{post.post_by}}" class="link-secondary link-underline-opacity-0">{{post.influencer.name}}</a> <!--redirect to influencer profile-->
                    </span>
                </p>
                <p class="text-muted">
                    <strong>Posted for:</strong>
                    <span id="post_for">
                        <a href="/view/{{post.request.campaign.campaign_id}}" class="link-secondary link-underline-opacity-0">{{post.request.campaign.campaign_name}}</a> <!--redirect to campaign-->
                    </span>
                </p>
                {%if post.request.status != 'Fullfilled/Paid'%}
                    {%if current_user.user_id == post.post_by%}
                        <button class="btn btn-outline-danger" onclick="delete_post('{{post.post_id}}')" type="submit">Delete Post</button>
                    {%endif%}
                    <br><br>
                    {%if post.request.campaign.campaign_by == current_user.user_id%}
                        <a href="/sponser/pay/{{post.request.request_id}}" class="btn btn-success">Pay for Request Completion</a>
                    {%endif%}
                {%endif%}

                {%if 'Admin' in roles%}
                    {%if post.flag %}
                        <div id="flag_cont{{post.post_id}}">
                            <button type="button" class="btn btn-danger" id="post{{post.post_id}}" onclick="flag_post('{{post.post_id}}', 'none')">Un-Flag</button>
                        </div>
                    {%else%}
                        <div id="flag_cont{{post.post_id}}">
                            <div class="btn-group">
                                <button type="button" class="btn btn-info dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                    <span id="post{{post.post_id}}">Flag</span>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><button class="dropdown-item" onclick="flag_post('{{post.post_id}}', 'Hateful_or_targeting')">Hateful or targeting</button></li>
                                    <li><button class="dropdown-item" onclick="flag_post('{{post.post_id}}', 'spam')">Spam</button></li>
                                    <li><button class="dropdown-item" onclick="flag_post('{{post.post_id}}', 'inapropriate_content')">Inapropriate Content</button></li>
                                </ul>
                            </div>
                        </div>
                    {%endif%}
                {%endif%}
            </div>
        </div>
    </div>
</div>
<script src="/st/js/submit.js"></script>
<script src="/st/js/profile_edits.js"></script>
{%endblock%}